Карта дождей

Я часто езжу на велосипеде и мотоцикле, поэтому вопрос "а будет ли дождь" беспокоит меня достаточно часто. Как оказалось, Центральная Аэрологическая Обсерватория регулярно <a href="http://www.meteorad.ru/maps">выкладывает у себя на сайте снимки с метеорологических радиолокаторов</a>. Чтобы ими пользоваться не хватает двух вещей: возможности приблизить карту и посмотреть как двигались облака за последний час. Если добавить эти две фичи, получается полезная штука:
<img src="https://habrastorage.org/files/c58/080/546/c580805467c746ffa0a60785175dc15b.gif"/>
Плохие новости: Росгидромет запретил ЦАО публиковать данные в реальном времени, теперь они доступны с задержкой в 24 часа. Ставьте лайки, возможно, получится в каком-то виде получить актуальные данные обратно.
Ничоси, про это даже петиция есть — "<a href="https://www.change.org/p/%D1%80%D0%BE%D1%81%D0%B3%D0%B8%D0%B4%D1%80%D0%BE%D0%BC%D0%B5%D1%82%D1%86%D0%B5%D0%BD%D1%82%D1%80%D1%83-%D0%B2%D0%B5%D1%80%D0%BD%D1%83%D1%82%D1%8C-%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D1%8B%D0%B9-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF-%D1%81%D0%BD%D0%B8%D0%BC%D0%BA%D0%BE%D0%B2-%D0%B4%D0%BC%D1%80%D0%BB-%D1%80%D0%B0%D0%B4%D0%B0%D1%80%D1%8B?source_location=petitions_share_skip">Вернуть открытый доступ снимков ДМРЛ (радары)</a>". И в Росгидромет уже <a href="http://habrahabr.ru/post/266303/#comment_8562753">письма писали</a>.
<cut/>
ЦАО <a href="http://www.meteorad.ru/screenshots/uvk.html?code=RAVN">публикует картинки вида</a>:
<img src="https://habrastorage.org/files/96d/251/c9c/96d251c9ca624944bcdf0d637c506459"/>

Нужно каким-то образом убрать все обозначения, оставить только области с осадками:
<img src="https://habrastorage.org/files/379/dd2/c76/379dd2c76ead4a178c44aba0dfcefa9c"/>

Для начала <a href="https://github.com/alexanderkuk/analyze-meteorad/blob/abf25313710e56ca40d820ba9b02cb54161b1290/main.py#L98-L103">выделим области, которые нужно оставить</a>. Это легко сделать, потому что каждой области соответствует определённый цвет пикселя:
<img src="https://habrastorage.org/files/492/dee/706/492dee7064464f33a87d58592449665b"/>

<a href="https://github.com/alexanderkuk/analyze-meteorad/blob/abf25313710e56ca40d820ba9b02cb54161b1290/main.py#L127-L149">Какие пиксели не попали в выделение</a>? Названия городов, границы областей, реки. Короче говоря, все обозначения:
<img src="https://habrastorage.org/files/0ab/850/470/0ab850470cec4048b60a2613d4e9eaec"/>

Для каждого такого пикселя <a href="https://github.com/alexanderkuk/analyze-meteorad/blob/abf25313710e56ca40d820ba9b02cb54161b1290/main.py#L152-L174">будем смотреть на его окрестность радиусом 9 и считать цветные пиксели</a>. Если в окрестности больше всего зелёных пикселей, то закрашиваем наш пиксель зелёным, если больше синих — синим. И о чудо:
<img src="https://habrastorage.org/files/09f/92b/62b/09f92b62bdea4cb480461fc2bbc91e61.gif"/>

Затем ставим <a href="https://github.com/alexanderkuk/analyze-meteorad/blob/abf25313710e56ca40d820ba9b02cb54161b1290/main.py#L71-L83">мониторинг на сайт ЦАО</a>. Каждые десять минут скачиваем и обрабатываем новую картинку. Наносим это всё на нормальную интерактивную карту. Если использовать Leaflet.js, <a href="http://leafletjs.com/reference.html#imageoverlay">это сделать несложно</a>. И получаем полезный простой прототип http://alexanderkuk.github.io/analyze-meteorad/ .

Затем связываемся с ЦАО, узнаём, что финансирования на эксплуатацию локаторов не хватает и поэтому данные никто бесплатно предоставлять не собирается. А картинки на <a href="http://www.meteorad.ru/maps">meteorad.ru</a> остались по недосмотру.

Давайте, вы все напишите, что вам интересны подобного рода данные и мы пойдём разговаривать с Росгидрометом.
