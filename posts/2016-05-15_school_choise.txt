Выбор школы в Москве the hard way

Полгода назад я писал про то, как <a href="https://habrahabr.ru/post/268839/">мы участвовали в конкурсе по открытым данным</a> с проектом "<a href="http://obr.msk.ru/">Московские школы</a>". Потом было <a href="https://habrahabr.ru/post/270675/">исследование московских результатов ЕГЭ</a>, <a href="https://habrahabr.ru/post/271923/">московских кружков и секций</a>. Недавно удалось собрать все результаты в одном месте и аккуратно оформить:
<img src="https://habrastorage.org/files/0bd/df3/f47/0bddf3f47dcc498fb8657edaf1e3b905"/>

Я хотел бы подробно рассказать про процесс сбора и обработки школьных данных. Оказывается, что для каждой школы в Москве публикуется достаточно много информации: результаты ЕГЭ, ГИА и олимпиад, профили учителей, бухгалтерская отчётность и списки кружков.
<cut />
<h4>Рейтинги</h4>
Департамент Образования Москвы каждый год составляет рейтинг школ. Доступны срезы за <a href=" http://dogm.mos.ru/rating/">2015</a>, <a href="http://dogm.mos.ru/rating/r2013_2014.php">2014</a> и <a href="http://dogm.mos.ru/rating/28.07.2014.php">2013</a> годы. Можно посмотреть не только на каком месте находится школа сейчас, но и на динамику. Если лень разбираться в разных версиях названий школ, например "Специализированный учебно-научный центр (факультет) - школа-интернат имени А.Н.Колмогорова" и "СУНЦ МГУ", можно взять <a href="https://github.com/alexanderkuk/moscow-school2/raw/master/data/check/ratings.xlsx">сводную таблицу из репозитория obr.msk.ru</a>. 

Нужно учитывать две вещи:<ol>
<li>Рейтинг может меняться по не зависящим от школы причинам. Например, приписали к школе вечёрку — рейтинг упал, хотя хуже учить не стали.</li>
<li>К рейтингу есть вопросы с точки зрения математики. Например, в <a href="http://dogm.mos.ru/rating/the-development-of-rating.php">описании</a> есть такая строчка "За каждого учащегося, который по каким-либо трем предметам на ЕГЭ набрал не менее 220 баллов, начисляется 1 балл". Пускай в одной школе ЕГЭ сдавало 100 человек и >220 набрало 10, а в другой сдавало 10 человек и >220 набрал 1. И там и там >220 набрало 10%, но первая школа получит 10 баллов, а вторая 1. Также интересно как они подбирают коэффициенты, почему за победителя Всеросов дают именно 10 баллов, а за призёра — 5.</li>
</ol>

И вообще, школа — очень сложная вещь: десятки учителей, сотни учеников, корпуса, кружки и секции. Как это можно свести к одной цифре? В топе рейтинга, действительно, хорошие школы. При этом низкая позиция ещё не означает, что школа плохая.

<h4>Сайты школ</h4>
В Москве почти все школьные сайты хостятся на одной платформе. Это очень удобно. <a href="http://obr.msk.ru/list.html">Список школ со ссылками есть на obr.msk.ru</a>. На сайтах школ есть много полезного:<ol>
<li>Списки корпусов. У школы есть юридический адрес и обычно его наносят на карту. Но это не совсем корректно. У 80% московских школ больше одного корпуса. Да, в 80% случаев эти корпуса находятся рядом (меньше 1.5 км), но бывает и так:
<img src="https://habrastorage.org/files/7cb/2c6/57d/7cb2c657d8214f8f9fe7aa3f2b740c11"/>
</li>
<li>В каких корпусах кто учится. 95% школ учат с 1 по 11 класс. Почти у всех есть ещё детские сады. Но часто начальным классам и, конечно, садикам выделяют отдельные здания. Поэтому может оказаться, что школа близко от дома, а нужный корпус далеко.
</li>
<li>Публичный доклад. На каждом сайте есть специальный раздел, куда директор каждый год выкладывает отчёт о работе школы. В половине случаев это актуальный содержательный документ, где в произвольной форме описывается всё: результаты проверок и мониторингов, успехи на олимпиадах, отчёты о поездах и праздниках. Кстати, это единственный открытый источник баллов по ЕГЭ по отдельным предметам.
<img src="https://habrastorage.org/files/f54/daf/93a/f54daf93a75147c1a0906b0fab4057e3.png"/>
</li>
<li>Фотки. 95% школ выкладывают на сайт фотографии с разных мероприятий и праздников. Иногда с их помощью можно получить представление о школьной инфраструктуре.
<img src="https://habrastorage.org/files/2a6/cbd/e62/2a6cbde6279d4c7daca901d1a89e0f34"/>
</li>
<li>Профили учителей. Больше 75% школ выкладывают на сайты списки учителей. Для каждого указана квалификация, стаж, образование и награды.
<img src="https://habrastorage.org/files/6d8/802/7cd/6d88027cd4d34d45ba08e3ba199afd6f"/>
</li>
</ol>
<h4>data.mskobr.ru</h4>
Пару месяц назад разработчики платформы, на которой работают все школьные сайты, запустили справочник http://data.mskobr.ru/. На первый взгляд ничего особенного, но если присмотреться можно найти вещи, которых нигде больше нет: <ol>
<li>Мобильные телефоны и личные емейлы сотрудников администрации. Директора не очень довольны, наверное, скоро данные уберут.</li>
<li>Число учеников и учителей. Можно измерять число учеников на одного учителя. Если оно больше 12-15, это странно.
<img src="https://habrastorage.org/files/ac0/15a/c4b/ac015ac4bb12490ab7d774e601890494"/>
</li>
<li>Сколько пришло в первый класс, сколько из них учились в садике при школе. Если, например, 80% первоклашек приходит из садика при школе, значит хорошо бы заранее записаться именно в этот садик.
</li>
<li>Средние зарплаты учителей и администрации. Если зарплата больше 75 000р., значит нагрузка на учителей выше среднего или школа хорошо зарабатывает на дополнительных услугах.
<img src="https://habrastorage.org/files/fb3/239/152/fb32391522304554a24d0e324c71899e"/>
</li>
</ol>
<h4>data.mos.ru</h4>
В начале 2016 года на Портале открытых данных Правительства Москвы появилось три датасета: <a href="http://data.mos.ru/opendata/7719028495-rezultaty-gia">результаты ГИА</a>, <a href="http://data.mos.ru/opendata/7719028495-rezultaty-ege-dogm">результаты ЕГЭ</a> и <a href="http://data.mos.ru/opendata/7719028495-pobediteli-olimpiad">победители олимпиад</a>.

<h5>ЕГЭ</h5>
Вообще результаты ЕГЭ для отдельных школ публикуются очень редко. Обычно это большой секрет. По Москве данные представлены в супер-агрегированном виде, для каждой школы известно только три числа: "сколько одиннадцатиклассников сдавало ЕГЭ", "сколько набрали >150 баллов по результатам трёх экзаменов", "сколько набрали >220 баллов". Сначала кажется, что данных слишком мало и ничего не выйдет, но это не так. С помощью серии вычитаний и сложений для каждой школы получаем три числа: "сколько одиннадцатиклассников набрали <150 баллов", "сколько от 150 до 220", "сколько >220". На эти три точки натягивает бета-распределение и рисуем графики. Получается достаточно информативно:
<img src="https://habrastorage.org/files/91d/850/ab3/91d850ab32674eb8b70fe5d0a81f71e5"/>
<img src="https://habrastorage.org/files/d8b/0db/95f/d8b0db95f6284dbeb9a3564fbf579e49"/>

Нужно понимать две вещи:<ol>
<li>ЕГЭ — это очень высокоуровневый показатель, но если результаты значительно хуже средних, наверное, лучше в такую школу не идти.</li>
<li>Нельзя просто так вычесть из всех сдававших тех, кто набрал >150 баллов и получить число тех, кто набрал <150. Некоторые одиннадцатиклассники сдают два экзамена. Иногда к школе приписывают пересдающих, их тоже надо исключать. К сожалению, таких данных нет и приходится немного корректировать результаты по запросу администраций школ.</li>
</ol>

<h5>Олимпиады</h5>
Табличка по олимпиадам на Портале открытых данных странная. Например, у Второй школы куча призёров и победителей по математике в старших классах, на портале указано всего 6 человек. Но есть прекрасный сайт — <a href="http://reg.olimpiada.ru/">Единая Система Регистрации на олимпиады школьников</a>. Особенно мне нравится их капча:
<img src="https://habrastorage.org/files/66b/437/392/66b4373927014c9fbd73a2d56def198c"/>

Там можно найти пофамильные списки победителей и призёров с указанием этапов олимпиад:
<img src="https://habrastorage.org/files/906/937/d67/906937d677dd4e6cad8f7e593a495380"/>

<h4>Финансы</h4>
Ещё один прекрасный сайт — http://bus.gov.ru/ . Для 90% школ там можно найти актуальную бухгалтерскую отчётность. Небольшой хак: не надо пытаться искать школу по названию, это бесполезно:
<img src="https://habrastorage.org/files/661/acc/159/661acc15991a41349196e771d2ccb044"/>

Сразу вбивайте ИНН, его можно найти на http://data.mskobr.ru :
<img src="https://habrastorage.org/files/c6d/e56/07e/c6de5607e82d464bb3d2a992d16fa3dd"/>

Затем делаем несколько неочевидных кликов:
<img src="https://habrastorage.org/files/1ef/1ec/387/1ef1ec387de54bbbad579b02cb0eaac5.gif"/>

И вуаля, можно посмотреть, какую долю доходов школа получает "от оказания платных услуг (работ)", сколько тратит в расчёта на одного ученика. Иногда можно даже посмотреть зарплату директора:
<img src="https://habrastorage.org/files/bad/b5d/c6a/badb5dc6a2be4cd096bea6bdd3b04cba"/>

<h4>ВКонтактик</h4>
Чтобы собрать профили московских школьников и выпускников, можно воспользоваться поиском. Проблема в том, что АПИ позволяет получить только первые 1000 результатов, а нужных профилей примерно 1000 000. Поэтому нужно сделать не один запрос, а много: "лицей 1535 мальчики 15 лет", "лицей 1535 девочки 15 лет", "лицей 1535 мальчики 16 лет" и так далее.

Удобно, что прямо в результатах поиска пишется вуз пользователя. Таким образом можно прикинуть, куда поступаю ученики школы. Для этого даже не нужно прокачивать профили. Правда, нужно быть аккуратным с МГУ и некоторыми другими вузами на букву "А". 90% пользователей ВК указывают именно их. Иногда уже в 5 классе.
<img src="https://habrastorage.org/files/42a/8fe/1b4/42a8fe1b455f4590b8ccb4d9218fea3e"/>

Также очень удобно собирать отзывы о школах. Создаёшь голосование, id всех проголосовавших известны, кто в какой школе учится известно:
<img src="https://habrastorage.org/files/7f8/cd1/e31/7f8cd1e318b24e349af2ae7fa42c9b1e"/>

Потом можно выводить статистику по школам:
<img src="https://habrastorage.org/files/b1f/e98/45c/b1fe9845c2184ff382b1b985deb64c67"/>

Самые основные показатели из упомянутых источников собраны на http://obr.msk.ru/ . Если вдруг кому-то надо, код открыт https://github.com/alexanderkuk/moscow-school2 .
