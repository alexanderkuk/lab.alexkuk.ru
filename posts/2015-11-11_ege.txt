Исследование результатов ЕГЭ, ГИА и олимпиад для московских школ. Из каких школ в какие ВУЗы поступают

Месяц назад я писал про наше участие <a href="http://habrahabr.ru/post/268839/">в хакатоне по открытым данным</a>.

После хакатона мы не остановились на достигнутом, как это обычно бывает, а продолжили работу. У нас на руках оказались данные, к которым раньше имели доступ, наверное, только сотрудники Министерства образования: результаты ГИА и победы на олимпиадах за 2014-2015 год для 90% московских школ. Для 55% школ удалось собрать данные по ЕГЭ за 2015 год. Прокачали все аккаунты московских школьников в Контакте, посмотрели, какие ВУЗы они указывают у себя в профайлах после окончания.

Естественно, было интересно поизучать такой датасет. Сначала тривиальные вещи, о которых люди из образования, наверное, хорошо знают: <ul>
<li>Баллы по ЕГЭ по гуманитарным предметам выше, чем по техническим. История — исключение;</li>
<li>Естественно-научные дисциплины посередине.</li>
</ul>
<img src="https://habrastorage.org/files/0c0/42b/b07/0c042bb0754c4319af3fef557b37d326"/>
<cut />
Для некоторых школ есть данные по ЕГЭ за 2014 год, поэтому можно попробовать посмотреть динамику за два года:
<ul>
<li>Как будто подрос балл по физике и немного упал балл по информатике;</li>
<li>Либо это шум, либо задания изменились, либо готовить стали по-другому.</li>
</ul>
<img src="https://habrastorage.org/files/d14/6b4/147/d146b4147aab40f38ec568092184d04e"/>

Для некоторых школ у нас есть не только баллы по ЕГЭ, но и число сдававших предмет. Можно посмотреть на популярность дисциплин. Скорее всего, люди в теме, это и так знают:
<ul>
<li>Русский — обязательный, его сдают все;</li>
<li>Часть, видимо, сдаёт базовую математику, мы рассматривали только профильную;</li>
<li>Выбросы в английском и физике происходят, наверное, за счёт спецшкол.</li>
</ul>
<img src="https://habrastorage.org/files/b77/876/1c2/b778761c287f444092b0c8593279e280"/>

Я думал, что чем популярнее предмет, тем выше по нему средний балл. Но, похоже, всё наоборот:
<img src="https://habrastorage.org/files/b7d/23d/167/b7d23d1676994086ae101fb2a945d0e2"/>

Теперь немного про ГИА. Я думал, что чем лучше в школе сдают ГИА, тем лучше через два года и баллы по ЕГЭ. Оказалось, что это справедливо только для русского и математики и от части для обществознания. Почему так, кто знает?

<img src="https://habrastorage.org/files/b8e/116/38f/b8e11638f5474a56ad84014b27df33b2"/>

Была гипотеза, что предпочтения по предметам меняются. Возможно, те кто сдавал, например, физику в 9 классе совсем не обязательно сдают физику в 11. Но по ГИА у нас тоже есть данные по числу сдающих и популярность предметов в целом совпадает с тем, что мы видим для ЕГЭ:

<img src="https://habrastorage.org/files/fab/3b7/b37/fab3b7b379994c559bb688a61d838494"/>

Может быть, дело в заданиях. Если упорядочить предметы по среднему баллу по ГИА, порядок будет совсем не такой, как для ЕГЭ:
<ul>
<li>Высокие баллы по информатике;</li>
<li>Засечки на целых баллах появляются, потому что некоторые школы округляют среднее до нулевого знака;</li>
<li>По истории, как и для ЕГЭ, баллы одни из самых низких.</li>
</ul>
<img src="https://habrastorage.org/files/859/3d6/f6b/8593d6f6b0a64d9fbbbe2e02eec806ba"/>

Теперь про олимпиады. У нас есть число победителей московских и всероссийских олимпиад по всем предметам. Было интересно проверить коррелируют ли успехи на олимпиадах со средним баллом по ЕГЭ по школе:
<ul>
<li>Иногда какая-то зависимость просматривается: для английского, обществознания, биологии, например;</li>
<li>Иногда не очень: для русского, литературы особой связи нет.</li>
</ul>
<img src="https://habrastorage.org/files/a52/e53/26f/a52e5326f0374c90bfaa86bbc04c2802"/>

Для всех школ известны координаты. Да, бывает, что зданий несколько, но мы пока смотрим на юридический адрес.

<img src="https://habrastorage.org/files/cc4/9d9/477/cc49d94774f54740a79be5246f832b24"/>

У меня было представление, что чем ближе школа к центру, тем она лучше. Но, похоже, это не так. По крайней мере, средний балл по ЕГЭ от близости к центру не зависит:

<img src="https://habrastorage.org/files/e69/668/129/e69668129659436e98bee76245052118"/>

Наверное, некоторых сейчас интересует откуда данные и почему им можно доверять. Результаты ГИА и олимпиад нам любезно предоставило Министерство образования. Они обещали, что скоро эти данные будут публично доступны. Результаты ЕГЭ по предметам, почему-то считаются большим секретом, поэтому нам пришлось их собирать вручную с сайтов школ. Все московские школы хостятся на портале mskobr.ru и у всех есть раздел "<a href="http://lyc1535.mskobr.ru/report/">публичный доклад</a>". Там обычно есть ссылка на документ, где директор школы в произвольный форме отчитывается за прошедший год. Естественно, все школы видят содержание и оформление отчёта по-разному:

<img src="https://habrastorage.org/files/f54/daf/93a/f54daf93a75147c1a0906b0fab4057e3.png"/>

Поэтому об автоматическом сборе данных пришлось забыть. Мы взяли классный инструмент для распознавания таблиц в PDF-документах — <a href=http://tabula.technology/>Tabula</a>. Немного её пропатчили и процесс сбора данных выглядел так:

<img src="https://habrastorage.org/files/7c6/02f/9fd/7c602f9fdc664cb3ae7855251538ba70.gif"/>

Через ~30 часов все ~600 документов были обработаны. Оказалось, что только из ~55% получается достать данные по ЕГЭ. Часто данные в отчёте несвежие или результатов ЕГЭ нет или нет именно средних баллов, а есть только, например, максимальные. Затем в ~300 школ, для которых удалось достать баллы по ЕГЭ были отправлены письма с просьбой проверить данные. ~30 школ ответили, 2 нашли ошибки, 5 прислали баллы чуть-чуть завышенные относительно отчёта, остальные сказали "норм". То есть с точностью больших проблем нет, есть проблемы с полнотой. Нужно где-то достать баллы ещё для ~300 школ.

Затем мы приступили к Контактику. Цель была определить из каких школ в какие ВУЗы чаще всего поступают. Первым делом нужно было объединить официальные названия школ, с теми которые использует Контакт. Это сделать не так просто. Потому что, например, у нас есть "Школа №17", а у ВК есть "Вечерняя школа №17", "Музыкальная школа №17  им. Л. Н. Оборина", "Школа-интернат №17". Кроме этого Контакт разрешает получать только 1000 результатов поисковой выдачи. Если школа указана более, чем в 1000 аккаунтов, а для московских школ это почти всегда так, то нужно что-то придумывать. Мы разбивали один запрос "школа №17" на несколько: "школа №17 девочки от 6 до 14",  "школа №17 мальчики от 6 до 14", "школа №17 девочки от 15 до 17",  "школа №17 мальчики от 15 до 17" и так далее. На запросы к поиску, похоже, существует какой-то нечёткий лимит. После ~50 обращений нас банили на ~1 час. Так или иначе через пару суток все аккаунты были прокачаны. На одну школу приходится в среднем ~1800 человек, из них ~450 указывают университет. 
<img src="https://habrastorage.org/files/558/e81/04d/558e8104d8684bc19024d3b0016bd43e"/>

Если использовать эти данные как есть, странным образом, 90% московских школьников поступают в МГУ. Поэтому применяется следующий изощрённый алгоритм: выкинуть МГУ. Да, например, для лицея №1533, откуда 50% людей уходит в МГУ этот алгоритм работает не очень хорошо, но другие подходы жутко ухудшаю покрытие для всех школ. Остаётся, например, не ~450 человек, а ~45, строить по ним распределение по ВУЗам не получается. Те, кто учился в школах  с картинки, пожалуйста, напишите соответствует гистограмма правде или нет:
<img src="https://habrastorage.org/files/632/2fe/2b3/6322fe2b31d8445ba4b59cb5a151543c"/>

Остальные школы можно попробовать поискать на http://obr.msk.ru
