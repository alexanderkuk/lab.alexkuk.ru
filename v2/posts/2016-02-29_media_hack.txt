Как мы участвовали в хакатоне по дата журналистике. Социально значимое: Государству виднее

Сегодня закончился <a href="https://data.sdh.sexy/ru/">первый хакатон по дата журналистике</a>. Мы заняли на нём первое место. Проделали огромный объём работы за одни сутки. Я хотел бы рассказать как всё было.

Темой хакатона были финансы российских СМИ. Ежегодно государство поддерживает СМИ, поднимающие в своих материалах социально важные темы. Для этого проводится специальный конкурс. Главным критерием отбора получателей субсидий является «социальная значимость» проекта. Мы решили понять, что скрывается за формулировкой «социальная значимость» и какие темы оказались самыми популярными и «дорогими» в 2015 году.

Забегая вперёд, скажу, что ответ такой:
<ul>
<li>По опросам очень много россиян считают себя патриотами, но государство всё равно даёт больше всего денег на проекты про патриотизм.</li>
<li>2015 год был годом литературы и на него пришлось 70 лет победы, поэтому "год литературы" и "историческая память в топе".</li>
<li>Субсидии, по идее, должны даваться на социально значимые проекты, "развитие Крыма", например, не очень в тему.</li>
<li>В целом складывается ощущение, что чаще пишут и читают об исторической памяти, чаще вспоминают достижения прошлых лет, в то время как на материалы об инновациях и новых технологиях государство выделяет меньше.</li>
</ul>
<img src="https://habrastorage.org/files/55a/7dc/dac/55a7dcdacde84318a5e6f7c47c66d8bd"/>

А теперь как мы пришли к этим выводам.
<cut />
Роспечать публикует каждый год у себя на сайте списки <a href="http://fapmc.ru/slabovid/statements/support/recipientsofstate/item48.html">субсидий для электронных СМИ</a> и список субсидий для <a href="http://fapmc.ru/slabovid/statements/support/recipientsofstate/item49.html">печатных СМИ</a>. Первый список выглядит так:
<img src="https://habrastorage.org/files/1e8/b08/6b1/1e8b086b16ca47ed83ce027e38246e35"/>

У нас есть название организации, название и описание проекта. Для каждой строчки нужно определить группу, к которой относится субсидия и её объём в рублях. С классификацией всё просто: берём <a href="http://www.fapmc.ru/rospechat/statements/support/grantingofstatesupport/item41/main/custom/00/02/file.pdf">список тематик, которые публикует Роспечать</a> и вручную размечаем ориентируясь на описания. Субсидий всего 2-3 сотни, поэтому разметку можно сделать за разумное время. С ценами сложнее: выделяем название издательства, например, "Радиовещательная Компания "Бурятия"", забиваем его <a href="http://budget.gov.ru/epbs/faces/p/%D0%91%D1%8E%D0%B4%D0%B6%D0%B5%D1%82/%D0%A0%D0%B0%D1%81%D1%85%D0%BE%D0%B4%D1%8B/%D0%A0%D0%B5%D0%B5%D1%81%D1%82%D1%80%20%D1%81%D0%BE%D0%B3%D0%BB%D0%B0%D1%88%D0%B5%D0%BD%D0%B8%D0%B9/%D0%A0%D0%B5%D0%B5%D1%81%D1%82%D1%80%20%D1%81%D1%83%D0%B1%D1%81%D0%B8%D0%B4%D0%B8%D0%B9?_adf.ctrl-state=wkynmtu3_100&_afrLoop=29397542337953404&_afrWindowMode=0&_afrWindowId=null#!%40%40%3F_afrWindowId%3Dnull%26_afrLoop%3D29397542337953404%26_afrWindowMode%3D0%26_adf.ctrl-state%3Dv1okeu5r0_4">в реестр субсидий</a>, скачиваем для найденные записи и в каждой ищем название проекта, например, "<a href="http://budget.gov.ru/epbs/faces/p/%D0%91%D1%8E%D0%B4%D0%B6%D0%B5%D1%82/%D0%A0%D0%B0%D1%81%D1%85%D0%BE%D0%B4%D1%8B/%D0%A0%D0%B5%D0%B5%D1%81%D1%82%D1%80%20%D1%81%D0%BE%D0%B3%D0%BB%D0%B0%D1%88%D0%B5%D0%BD%D0%B8%D0%B9/%D0%A0%D0%B5%D0%B5%D1%81%D1%82%D1%80%20%D1%81%D1%83%D0%B1%D1%81%D0%B8%D0%B4%D0%B8%D0%B9?_adf.ctrl-state=v1okeu5r0_4&_afrLoop=29741026235073732&_afrWindowMode=0&_afrWindowId=null#!%40%40%3F_afrWindowId%3Dnull%26_afrLoop%3D29741026235073732%26_afrWindowMode%3D0%26_adf.ctrl-state%3Dtsv0mwicb_4">Бессмертный полк. Мы помним</a>" и выписываем цену. Для 75% проектов процедура отрабатывает автоматически. С остальными нужно разбираться вручную.
<img src="https://habrastorage.org/files/e7d/509/f13/e7d509f131a44c6aab003c2c29b909a6"/>

Со списком субсидий для печатных СМИ сложнее. Список выглядит так:
<img src="https://habrastorage.org/files/ed9/857/557/ed9857557ea94be8929a6e89426e59b2"/>

Записей уже около тысячи, поэтому ручная разметка происходит не так бодро. В списке нет названий организаций, а значит просто найти субсидии в реестре не получится. Выход есть: берём <a href="http://rkn.gov.ru/opendata/7705846236-ResolutionSMI/">реестр СМИ, который публикует Роскомнадзор</a>, он выглядит так:
<img src="https://habrastorage.org/files/378/386/1f1/3783861f10314a46a3d17e13f307c204"/>

По названию издания находим ИНН издательства. Искать можно по точному совпадению, покрытие получается хорошее. Дальше вбиваем все эти ИННы в реестр субсидий и скачиваем все результаты. Теперь самое сложное: среди всех записей нужно найти только те, которые соответствуют проектам, фигурирующим в списке Роспечати. Названия проектов есть только в договорах, договоры это пдфы со сканами, автоматически с ними ничего не сделаешь:
<img src="https://habrastorage.org/files/485/69e/6eb/48569e6eb61a471bba91be11d579fdde"/>

Поэтому скачиваем все пдфы просматриваем их вручную и записываем цены в соответствующие ячейки. За 4-5 часов удалось провернуть операцию для 50% записей. В итоге получается две таблицы для электронных и печатных СМИ, в каждой строчке цены и категория. Если что эти таблицы можно скачать их нашего репозитория https://github.com/alexanderkuk/media-hack/tree/master/data

Дальше получаем график, который я показывал вначале:
<img src="https://habrastorage.org/files/55a/7dc/dac/55a7dcdacde84318a5e6f7c47c66d8bd"/>

И смотрим детализацию для некоторых интересных категорий:
<img src="https://habrastorage.org/files/bd0/0d4/7c2/bd00d47c2cc94478bdc0276123b57fc1"/>

В ходе ручной разметки неизбежно находятся странные проекты, на которые была потрачена куча денег:
<img src="https://habrastorage.org/files/06f/bb3/1ee/06fbb31eeffb404d8347ffde53200c2e"/>
<img src="https://habrastorage.org/files/472/6f3/83e/4726f383ec7a4aa18729ca96fdf3f02d"/>

Всего вышеописанного нам конечно показалось недостаточно и мы собрали ещё инфу по госконтрактам.  На http://clearspending.ru/ мы нашли все контракты, в которых есть подстроки «пропаганда», «популяризация», «воспитание» или «имидж». Посмотрели, какие коды ОКПД чаще всего встречаются и немного их обобщили их с помощью <a href="http://www.gov-zakupki.ru/cody/okpd/92.20.1">реестра кодов</a>:
<img src="https://habrastorage.org/files/e31/a28/d7e/e31a28d7eb0c4eefb478ef02b3d4fab2"/>

Затем опять взяли реестр СМИ Роскомнадзора, собрали из него ИННы всех издательств, получилось примерно 32 000 штук, скачали для каждого из них выдачу clearspending.ru и оставили только контракты за 2015 год с одним из отобранных кодов ОКПД. Получилось примерно 3000 контрактов. Дальше их нужно было классифицировать. Мы составили набор простых правил вида:<source lang="python">
    u'Инвалидность': [
        u'доступной среды для инвалидов и маломабильных групп',
        u'безбарьерной среды для инвалидов и маломабильных групп',
        u'социальной интеграции'
        ],
    u'Рабочие профессии': [
        u'рабочие профессии',
        
        u'популяризации рабочих профессий',
        ],
    u'Предпринимательство': [
        u'предпринимательство',
        u'молодой предприниматель',
        u'малое и среднее предпринимательство'
    ],
    u'ДТП': [
        u'участников дорожного движения',
        u'дорожно-транспортный травматизм',
        u'о состоянии проезда',
    ],
</source>

Прогнали их по всему списку и увидели интересное: в контрактах встречаются заказы на пропаганду толерантности, здорового образа жизни, достижений в сельском хозяйстве, однако большая часть заказных статей СМИ направлена на самопиар государственных органов:
<img src="https://habrastorage.org/files/149/b6d/fda/149b6dfda72b402eb1df69d17978b887"/>

Все наблюдения оформили в виде сайта http://zina.tilda.ws/ , код и данные выложили на https://github.com/alexanderkuk/media-hack
